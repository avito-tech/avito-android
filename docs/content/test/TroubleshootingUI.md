---
title: Troubleshooting UI Tests
type: docs
---

# Troubleshooting

## Известные баги тестового фреймворка

- [Jira Filter](http://links.k.avito.ru/Dg)
- Автофокус камеры зависает на 22 API (https://issuetracker.google.com/issues/139438163)

## Как понять почему упал тест?

### Teamcity

Для начала можно посмотреть в TeamCity, открыв тест можно увидеть краткую выжимку о причинах падения

Есть краткая причина падения не информативна - это повод [написать нам]({{<ref "/test/Support.md" >}}).

### Report Viewer

Используем отчеты в [Report Viewer](http://links.k.avito.ru/cfxRp7KAg), которые содержат:

- **Видео** с эмулятора
    - Только для упавших тестов
    - Только для API 23+. На меньших версиях технологии не позволяют записывать надежно
- **Скриншоты:** до и после каждого шага, во время падения
- **Трейс ошибки**: цепочка событий которая привела к ошибке
- **Logcat** для упавших тестов
- **HTTP** запросы и ответы во время шагов
- **Логи запросов к ресурсам**: Resource Manager, AB/test, Integration API, phones
- **Логи действий тестового фреймворка**

### Report Viewer локально

При запуске теста локально, ссылка на Report Viewer тоже формируется и доступна в logcat, ищите по фильтру: `rv.k`.

### Layout Inspector

<br> *Layout inspector использует adb поэтому мы не можем получить состояние экрана в дебажном запуске.* \
<br> __Как получить экран во время прогона теста?__
1. Добавить в нужное место `Thread.sleep()`.
2. Запустить тест без дебага и дождаться пока исполнение попадет в `Thread.sleep()`
3. Задампить состояние экрана через Layout Inspector

## Что делать если тест flaky?

### 1. Убедись что тест действительно флакует

В первую очередь смотрим [статистику]({{< ref "#где-посмотреть-статистику-по-стабильности-тестов" >}})

Можно запустить [динамическую конфигурацию]({{< ref "/test/DynamicConfig.md" >}}), указав тест и несколько прогонов сразу.

Обратите внимание на все возможности которые есть в [приложенном отчете]({{< ref "/test/TroubleshootingUI.md" >}}).

Запуск также полезно использовать чтобы убедится, что изменения помогли побороться с нестабильным поведением.

### 2. Отлаживай в IDE

В Android Studio должен из коробки работать debug на конкретном тесте.

https://developer.android.com/studio/debug

### 3. Если не удалось найти причину

[Обратись за помощью]({{<ref "/test/Support.md" >}})

Обязательно приложи:

- Ссылку на репорт
 
Будет полезно: 

- Логи с ошибками

## Где посмотреть статистику по стабильности тестов?

- [Общая статистика по тестам](http://links.k.avito.ru/FR)
- [История нестабильности теста](http://links.k.avito.ru/5W)

Обратите внимание на параметры фильтрации.
