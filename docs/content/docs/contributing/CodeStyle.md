---
title: Code style
type: docs
---

# Code Style

## Автоматизация

### Editor config

За настройку code style отвечает [editor config](https://editorconfig.org/). 
А точнее [плагин для IDE](https://plugins.jetbrains.com/plugin/7294-editorconfig/).

Нужно убедиться, что плагин установлен и включен (**Preferences > Plugins > Installed > search: EditorConfig**)

После этого все настройки авто-формата должны применяться по порядку:
1. EditorConfig настройка на уровне папки
1. EditorConfig настройка на уровне проекта
1. Личная настройка в IDE (если не определены настройки выше)

Правила определены в `.editorconfig` в корне проекта. И переопределены в папках где значения по-умолчанию не устраивают
(например `ci/docker/android-builder/.editorconfig`).

### .idea/codeStyles (legacy)

Отказались от использования xml, которые сохраняет IDE.    
Разные версии Android Studio автоматически вносят изменения в файл настроек и это невозможно отключить.
Как итог, получали нежелательные и конфликтующие изменения. 
Это отвлекает и мешает использовать разные версии IDE.

### Если автоматика сломалась

Порой по разным причинам автоматические настройки code style слетают, это больное место в Android Studio.
Причиной может быть к примеру обновление версии.

Выставить настройки близкие к автоматическим можно так:

- `Preferences -> Editor -> Code Style` установить **Hard wrap - 120**
- `Preferences -> Editor -> Code Style -> Kotlin`
    - `Set From -> Predefined Style -> Kotlin Style Guide`
    - `Imports -> Use single name import` в обоих опциях 
    - `Imports -> Packages to Use Imports with * - удалить все` 

### Проверки в CI

В данный момент соответствия code style проверяются вручную на [Code Review]({{< ref "/docs/contributing/CodeReview.md" >}})
(Задача на автоматизацию - MBS-6991 (internal)).


## Code guidelines

### Именование

#### Packages

- Не должен содержать заглавные символы, чтобы избегать конфликтов с интерфейсами и классами.
- Допускается использования символа `_`

С точки зрения бизнес-модулей стараемся делать плоскую структуру пакетов, не привязываясь к навигации.
Примеры:

- `categories` вместо `category/list`

#### Variables

- Детальность названия должна соответствовать области видимости.
- Не экономим на буквах в ущерб читаемости. Сокращения допустимы для общепринятых терминов.

```kotlin
val ctx: Context
val context: Context
```

- Имя должно отражать смысл. Избегаем излишних  знаний про реализацию и тип данных.

```kotlin
val bundle: Bundle
val state: Bundle
```

### Kotlin

Используем [Kotlin official style guide](https://kotlinlang.org/docs/reference/coding-conventions.html)

#### File structure

Extension функции и свойства рекомендуется располагать в файле с названием расширяемого класса во множественном числе.
Исключение: Если extension относится к _типизированной_ коллекции, то он должен располагаться в файле с названием типа а не коллекции.
_Мотивация_: однозначный поиск, не нужно думать куда это положили.
Пример:

```kotlin
Views.kt:
fun View.hide() = ...
```

```kotlin
Dimensions.kt:
fun List<Dimension>.findByRatio() = ...
```

```kotlin
Lists.kt:
fun List<T>.second() = ...
```

#### Публичные классы и файлы

В файле должно быть не более одного публичного класса\интерфейса\аннотации\... 
Исключение делаем для вырожденных реализаций интерфейса, которым нельзя придумать осмысленного именования и из-за этого не может быть нескольких  имплементаций (`...Impl` и т.п.).

_Мотивация:_ нужны простые и однозначные правила для навигации, иначе имя файла становится бесполезным. 
Если каждый будет располагать согласно предпочтениям, то это может привести к бесконечному рефакторингу и лишним спорам.

#### Константы

Константные значения на уровне файла называем в нотации _ALL_UPPER_CASE_. 
Значения для строковых констант по возможности пишем в _snake_case_.
Не мусорим в пространстве имен: обязательно используем минимально возможную видимость 
(`private` если используется только в этом файле, `internal` если используется только в пределах модуля).
Примитивные значения и строки дополнительно помечаем модификатором [const](https://kotlinlang.org/docs/reference/properties.html#compile-time-constants)

```kotlin
private const val KEY_MESSAGE = “key_fragment_message"
internal const val INVALID_POSTIION = Int.MIN_VALUE
```

**Аргументы функций**
Неочевидные аргументы необходимо именовать при вызове.

**Platform types**
Избегаем платформенные типы. При взаимодействии с Java кодом указывать типы явно, чтобы избежать потенциальных ошибок.

```kotlin
val fooId = arguments.getString(KEY_FOO_ID) // --> String!
val fooId: String? = arguments.getString(KEY_FOO_ID) // --> String?
```

**Reified type parameters**
При наличии альтернативы предпочтительно вывести тип автоматически, средствами языка, чтобы избежать возможных ошибок при приведении типа:

```kotlin
val location = readParcelable(Profile::class.java.classLoader)
val location = readParcelable()
```

### Комментарии

**Комментирование кода**
Комментариев избегаем. Используем только для пояснения неочевидных моментов, но максимально пытаемся выразить смысл кодом.
Временное комментирование кода допускается в feature ветках. От неиспользуемого кода избавляемся и не пытаемся использовать комментарии вместо VCS.
_Мотивация:_ устаревание комментариев, они начинают врать, а это хуже чем их отсутствие.

При необходимости временно закомментировать участок кода предпочтительно использовать `//` комментарии вместо `/* */`.
_Мотивация:_ проще редактировать, т.к. у каждой строки нет "контекста". Например, проблемно раскомментировать несколько строк внутри `/* */` комментария.

**Комментирование решений**
При необходимости пояснить решение избегаем комментарии. Необходимо выражать смысл кодом - в названиях переменных, методов и т.п.
Пример - дублирование if, который не поясняет смысл проверки.
_Мотивация_: код должен быть самодокументируемым.
Комментарии легко устаревают, становятся ложными и могут даже навредить, введя в заблуждение (см. Clean Code)

**TODO комментарии**
Допускаются комментарии вида // TODO comment
Обязательно наличие пояснения.
_Rule of thumb:_ из комментария сразу должна быть понятна суть. Иначе этот комментарий не нужен.

### Deprecations

Когда в коде появляется новый класс или метод, который дублирует функции уже существующего, то желательно удалять старый. 
Если такой возможности нет, то помечаем старый класс или метод аннотацией @Deprecated, но обязательно с комментарием и указателем на новый.
Для kotlin аннотации @Deprecated обязательными для заполнения параметрами являются message и replaceWith.

### Imports

**Fully qualify imports**
This is bad: `import foo.*`
This is good: `import foo.Bar`
_Мотивация_: используемые зависимости очевидны, меньше конфликтов. Читаемость и поддерживаемость важнее.
[Источник](https://source.android.com/source/code-style.html#fully-qualify-imports)

### Ordering

**Порядок методов и полей**
Публичное преимущественно располагаем в начале класса, приватное и с большей детализацией - ниже.
Метод должен быть при возможности сразу после места его использования.
_Мотивация:_ основная цель - обеспечить хорошую читаемость кода. В идеале код должен читаться как рассказ. Для этого надо минимизировать навигацию при чтении.

## XML

Размеры, отступы и кегли шрифтов выносим в `dimens.xml`, если они повторяются или имеют разные значения для разных конфигураций экранов.
Даем осмысленные имена в _snake_case_. Пример: `<dimen name="list_card_vertical_padding">4dp</dimen>`
_Мотивация_: быстрая адаптация верстки к различным экранам.

Layout называем придерживаясь правила `<where>[_<description>].xml`

- `<where>` описывает экран или его логическую часть.
- `<description>` - необязательное описание. Может включать в себя маркеры типа: _activity_, _fragment_ и тп.

Пример: `profile_editor.xml`, `offer_common_part.xml`, `balance.xml`, `order_item.xml`
_Мотивация_: быстрая и удобная навигация в папках с ресурсами, благодаря переносу смысловой нагрузки в начало. `order[_activity].xml` вместо `activity_order.xml`

С помощью  [FOLDING_PLUGIN](https://github.com/dmytrodanylyk/folding-plugin), можно добиться групирования по виртуальным папкам.

view id именуем в _snake_case_. Пример: `android:id="@+id/category_title"`.

Стили называем в _PascalCase_. Пример: `<style name="AvitoButton.Transparent">`.
