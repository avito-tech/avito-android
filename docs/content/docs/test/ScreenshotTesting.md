---
title: Скриншотные тесты
type: docs
---

# Скриншотные тесты

## Цель

Скриншотные тесты позволяют вовремя отследить изменения цветов / стилей и предотвратить нежелательные изменения в UI

## Что именно покрывают скриншотные тесты?

Сейчас скриншотные тесты распространяются *только* на компоненты из дизайн системы

## Ограничения

В данный момент скриншотные тесты заливаются в git **без** использования git-lfs. 
Разумеется, если скриншотов в истории git будет слишком много, то вес репозитория будет слишком большой и работа с ним в целом замедлится.
По рассчетам еще не скоро это станет проблемой, договорились что стоит поднимать вопрос после планки в **50 mb**

### Как узнать сколько места скриншоты занимают сейчас?

Следует запустить скрипт, который покажет текущий размер директории, учитывая удаленные и замененные файлы

**Примечание:** сейчас в папке со скриншотами так же есть в истории скриншоты старых тестов, занимающие 16 mb

```bash
sh screenshot_test_size.sh
```

### Как узнать какие именно файлы были посчитаны?

Запустить скрипт:

```bash
sh file-sizes.sh
```

## Я поменял цвета/стили и теперь скриншотные тесты не проходят на CI, что делать?

- Убедиться что поменялось только то, что нужно.
- Обязательно добавить `@aodanilov` и `@poignatov` в PR
- (Опционально) удалить папку /design-app/src/androidTest/assets/screenshots
- Выставить [нужный эмулятор]({{< ref "/docs/ci/Containers.md" >}}) локально

    **Примечание:** просто создать эмулятор не выйдет, так как эмулятор на CI обладает кастомными характеристиками, 
    поэтому нужно взять характеристики для 27 API из [/ci/docker/android-emulator/hardware](https://github.com/avito-tech/avito-android/tree/develop/ci/docker/android-emulator/hardware)
    и добавить их в `config.ini` своего эмулятора, который лежит по адресу `~/.android/avd/<название эмулятора>.avd`
    самое главное - это сделать одинаковыми параметры 
    
    `hw.lcd.width`
    
    `hw.lcd.height`
    
    `hw.lcd.density`
- Проверить, что все остальные эмуляторы **выключены**    
- Перегенерировать скриншоты командой

```bash
sh record_screenshots.sh
```

- Скриншоты добавятся в папку `/design-app/src/androidTest/assets/screenshots/`
- Можно коммитить их и пушить

## Где хранятся скриншоты?

Скриншоты хранятся в папке `/design-app/src/androidTest/assets/screenshots`\
Внутри этой папки скриншоты разделяются по папкам далее используя контракт имени `API_{API_VERSION}_{WIDTH}x{HEIGHT}_{DENSITY}`, 
на данный момент используется только один эмулятор, соответственно название папки выглядит так: API_27_320x480_120

